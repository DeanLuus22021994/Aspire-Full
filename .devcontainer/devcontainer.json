{
  "name": "Aspire-Full GPU Compute",
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."
  },

  // GPU passthrough for CUDA/CU compute
  "runArgs": ["--gpus=all", "--memory=2g", "--memory-swap=2g", "--shm-size=256m"],

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      "moby": true
    }
  },

  "customizations": {
    "vscode": {
      "extensions": ["ms-dotnettools.csharp", "ms-dotnettools.csdevkit", "GitHub.copilot", "GitHub.copilot-chat"],
      "settings": {
        "dotnet.defaultSolution": "Aspire-Full.slnx",
        "editor.formatOnSave": true,
        "files.exclude": {
          "**/bin": true,
          "**/obj": true
        }
      }
    }
  },

  "forwardPorts": [5000, 5001, 5432, 6379, 6333, 18888],
  "portsAttributes": {
    "5000": { "label": "API" },
    "5001": { "label": "Gateway" },
    "5432": { "label": "PostgreSQL", "onAutoForward": "silent" },
    "6379": { "label": "Redis", "onAutoForward": "silent" },
    "6333": { "label": "Qdrant", "onAutoForward": "silent" },
    "18888": { "label": "Aspire Dashboard", "onAutoForward": "openBrowser" }
  },

  "postCreateCommand": "dotnet restore",
  "postStartCommand": "echo 'GPU Compute Ready | 2GB RAM | CUDA/CU Mode'",

  "remoteEnv": {
    "ASPIRE_ALLOW_UNSECURED_TRANSPORT": "true",
    "DOTNET_ENVIRONMENT": "Development",
    "ASPIRE_COMPUTE_MODE": "Gpu",
    "ASPIRE_FALLBACK_TO_CPU": "false"
  },

  "containerEnv": {
    "DOTNET_CLI_TELEMETRY_OPTOUT": "1",
    "DOTNET_NOLOGO": "1",
    "DOTNET_GCHeapHardLimit": "1610612736"
  }
}
