{
  "name": "Aspire-Full GPU Tensor Compute",
  "build": {
    "dockerfile": "Dockerfile",
    "context": "..",
    "args": {
      "BUILDKIT_INLINE_CACHE": "1"
    }
  },

  // GPU passthrough for CUDA/CU compute - 9GB RAM optimized with full privileges
  "runArgs": [
    "--privileged",
    "--gpus=all",
    "--memory=9g",
    "--memory-swap=12g",
    "--shm-size=2g",
    "--ulimit=memlock=-1:-1",
    "--ulimit=stack=67108864:67108864",
    "--ipc=host",
    "--cap-add=SYS_PTRACE",
    "--security-opt=seccomp=unconfined"
  ],

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest",
      "moby": true
    }
  },

  "customizations": {
    "vscode": {
      "extensions": ["ms-dotnettools.csharp", "ms-dotnettools.csdevkit", "GitHub.copilot", "GitHub.copilot-chat"],
      "settings": {
        "dotnet.defaultSolution": "Aspire-Full.slnx",
        "editor.formatOnSave": true,
        "files.exclude": {
          "**/bin": true,
          "**/obj": true
        }
      }
    }
  },

  "forwardPorts": [5000, 5001, 5432, 6379, 6333, 18888],
  "portsAttributes": {
    "5000": { "label": "API" },
    "5001": { "label": "Gateway" },
    "5432": { "label": "PostgreSQL", "onAutoForward": "silent" },
    "6379": { "label": "Redis", "onAutoForward": "silent" },
    "6333": { "label": "Qdrant", "onAutoForward": "silent" },
    "18888": { "label": "Aspire Dashboard", "onAutoForward": "openBrowser" }
  },

  "postCreateCommand": "dotnet restore",
  "postStartCommand": "echo 'ðŸš€ GPU Tensor Compute Ready | 9GB RAM | CUDA/Hybrid Mode | Dynamic Batching Enabled'",

  "remoteEnv": {
    "ASPIRE_ALLOW_UNSECURED_TRANSPORT": "true",
    "DOTNET_ENVIRONMENT": "Development",
    "ASPIRE_COMPUTE_MODE": "Hybrid",
    "ASPIRE_OFFLOAD_STRATEGY": "Full",
    "ASPIRE_FALLBACK_TO_CPU": "true",
    "ASPIRE_MAX_BATCH_SIZE": "64",
    "ASPIRE_ENABLE_DYNAMIC_BATCHING": "true"
  },

  "containerEnv": {
    "DOTNET_CLI_TELEMETRY_OPTOUT": "1",
    "DOTNET_NOLOGO": "1",
    "DOTNET_GCHeapHardLimit": "7516192768",
    "DOTNET_gcServer": "1",
    "DOTNET_TieredPGO": "1",
    "OMP_NUM_THREADS": "8",
    "OPENBLAS_NUM_THREADS": "8"
  }
}
