@using Aspire_Full.Tensor

@if (Models.Count == 0)
{
    <p class="muted">Tensor model catalog is currently empty.</p>
}
else
{
    <div class="tensor-models">
        @foreach (var model in Models)
        {
            <article class="tensor-model-card">
                <header>
                    <div>
                        <h3>@model.DisplayName</h3>
                        <p class="muted">@model.Description</p>
                    </div>
                    <span class="tensor-badge">@model.Id</span>
                </header>
                <dl>
                    <div>
                        <dt>Embedding Size</dt>
                        <dd>@model.EmbeddingSize</dd>
                    </div>
                    <div>
                        <dt>Input Shape</dt>
                        <dd>@FormatInputShape(model)</dd>
                    </div>
                    <div>
                        <dt>Repository</dt>
                        <dd>@FormatRepository(model)</dd>
                    </div>
                </dl>
                <footer>
                    <div class="provider-group">
                        <span>Preferred:</span>
                        @if (!HasProviders(model.PreferredExecutionProviders))
                        {
                            <span class="muted">n/a</span>
                        }
                        else
                        {
                            @foreach (var provider in model.PreferredExecutionProviders)
                            {
                                <span class="provider-pill">@provider</span>
                            }
                        }
                    </div>
                    <div class="provider-group">
                        <span>Alternates:</span>
                        @if (!HasProviders(model.AlternateExecutionProviders))
                        {
                            <span class="muted">n/a</span>
                        }
                        else
                        {
                            @foreach (var provider in model.AlternateExecutionProviders)
                            {
                                <span class="provider-pill alt">@provider</span>
                            }
                        }
                    </div>
                    @if (Capabilities is not null)
                    {
                        <span class="provider-recommendation">Runtime prefers @Capabilities.RecommendedExecutionProvider</span>
                    }
                </footer>
            </article>
        }
    </div>
}

@code {
    [Parameter]
    public IReadOnlyList<TensorModelDescriptor> Models { get; set; } = Array.Empty<TensorModelDescriptor>();

    [Parameter]
    public TensorCapabilityResponse? Capabilities { get; set; }

    private static string FormatRepository(TensorModelDescriptor model) =>
        string.IsNullOrWhiteSpace(model.Tag) ? model.Repository : $"{model.Repository}:{model.Tag}";

    private static string FormatInputShape(TensorModelDescriptor model) =>
        model.InputShape.Count == 0 ? "n/a" : string.Join(" Ã— ", model.InputShape);

    private static bool HasProviders(IList<string> values) => values.Count != 0;
}
